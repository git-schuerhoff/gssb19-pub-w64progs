VarienForm=Class.create();VarienForm.prototype={initialize:function(n,t){if((this.form=$(n),this.form)&&(this.cache=$A(),this.currLoader=!1,this.currDataIndex=!1,this.validator=new Validation(this.form),this.elementFocus=this.elementOnFocus.bindAsEventListener(this),this.elementBlur=this.elementOnBlur.bindAsEventListener(this),this.childLoader=this.onChangeChildLoad.bindAsEventListener(this),this.highlightClass="highlight",this.extraChildParams="",this.firstFieldFocus=t||!1,this.bindElements(),this.firstFieldFocus))try{Form.Element.focus(Form.findFirstElement(this.form))}catch(i){}},submit:function(){return this.validator&&this.validator.validate()&&this.form.submit(),!1},bindElements:function(){var n=Form.getElements(this.form);for(var t in n)n[t].id&&(Event.observe(n[t],"focus",this.elementFocus),Event.observe(n[t],"blur",this.elementBlur))},elementOnFocus:function(n){var t=Event.findElement(n,"fieldset");t&&Element.addClassName(t,this.highlightClass)},elementOnBlur:function(n){var t=Event.findElement(n,"fieldset");t&&Element.removeClassName(t,this.highlightClass)},setElementsRelation:function(n,t,i,r){(n=$(n))&&(this.cache[n.id]||(this.cache[n.id]=$A(),this.cache[n.id].child=t,this.cache[n.id].dataUrl=i,this.cache[n.id].data=$A(),this.cache[n.id].first=r||!1),Event.observe(n,"change",this.childLoader))},onChangeChildLoad:function(n){element=Event.element(n);this.elementChildLoad(element)},elementChildLoad:function(n,t){this.callback=t||!1;n.value&&(this.currLoader=n.id,this.currDataIndex=n.value,this.cache[n.id].data[n.value]?this.setDataToChild(this.cache[n.id].data[n.value]):new Ajax.Request(this.cache[this.currLoader].dataUrl,{method:"post",parameters:{parent:n.value},onComplete:this.reloadChildren.bind(this)}))},reloadChildren:function(n){var t=eval("("+n.responseText+")");this.cache[this.currLoader].data[this.currDataIndex]=t;this.setDataToChild(t)},setDataToChild:function(n){var r,t,i;if(n.length){if(t=$(this.cache[this.currLoader].child),t){i='<select name="'+t.name+'" id="'+t.id+'" class="'+t.className+'" title="'+t.title+'" '+this.extraChildParams+">";this.cache[this.currLoader].first&&(i+='<option value="">'+this.cache[this.currLoader].first+"<\/option>");for(r in n)n[r].value&&(i+='<option value="'+n[r].value+'"',t.value&&(t.value==n[r].value||t.value==n[r].label)&&(i+=" selected"),i+=">"+n[r].label+"<\/option>");i+="<\/select>";Element.insert(t,{before:i});Element.remove(t)}}else t=$(this.cache[this.currLoader].child),t&&(i='<input type="text" name="'+t.name+'" id="'+t.id+'" class="'+t.className+'" title="'+t.title+'" '+this.extraChildParams+">",Element.insert(t,{before:i}),Element.remove(t));this.bindElements();this.callback&&this.callback()}};RegionUpdater=Class.create();RegionUpdater.prototype={initialize:function(n,t,i,r,u,f){this.countryEl=$(n);this.regionTextEl=$(t);this.regionSelectEl=$(i);this.zipEl=$(f);this.config=r.config;delete r.config;this.regions=r;this.disableAction=typeof u=="undefined"?"hide":u;this.zipOptions=typeof zipOptions=="undefined"?!1:zipOptions;this.regionSelectEl.options.length<=1&&this.update();Event.observe(this.countryEl,"change",this.update.bind(this))},_checkRegionRequired:function(){var n,i,r=[this.regionTextEl,this.regionSelectEl],u=this,t;typeof this.config!="undefined"&&(t=this.config.regions_required.indexOf(this.countryEl.value)>=0,r.each(function(r){Validation.reset(r);n=$$('label[for="'+r.id+'"]')[0];n&&(i=n.down("em")||n.down("span.required"),u.config.show_all_regions||(t?n.up().show():n.up().hide()));n&&i&&(t?t&&(i.show(),n.hasClassName("required")||n.addClassName("required")):(i.hide(),n.hasClassName("required")&&n.removeClassName("required")));t?(r.hasClassName("required-entry")||r.addClassName("required-entry"),"select"!=r.tagName.toLowerCase()||r.hasClassName("validate-select")||r.addClassName("validate-select")):(r.hasClassName("required-entry")&&r.removeClassName("required-entry"),"select"==r.tagName.toLowerCase()&&r.hasClassName("validate-select")&&r.removeClassName("validate-select"))}))},update:function(){var t,n,i,r;if(this.regions[this.countryEl.value]){i=this.regionSelectEl.getAttribute("defaultValue");this.regionTextEl&&(i||(i=this.regionTextEl.value.toLowerCase()),this.regionTextEl.value="");this.regionSelectEl.options.length=1;for(regionId in this.regions[this.countryEl.value])n=this.regions[this.countryEl.value][regionId],t=document.createElement("OPTION"),t.value=regionId,t.text=n.name.stripTags(),t.title=n.name,this.regionSelectEl.options.add?this.regionSelectEl.options.add(t):this.regionSelectEl.appendChild(t),(regionId==i||n.name&&n.name.toLowerCase()==i||n.name&&n.code.toLowerCase()==i)&&(this.regionSelectEl.value=regionId);this.disableAction=="hide"?(this.regionTextEl&&(this.regionTextEl.style.display="none"),this.regionSelectEl.style.display=""):this.disableAction=="disable"&&(this.regionTextEl&&(this.regionTextEl.disabled=!0),this.regionSelectEl.disabled=!1);this.setMarkDisplay(this.regionSelectEl,!0)}else this.regionSelectEl.options.length=1,this.disableAction=="hide"?(this.regionTextEl&&(this.regionTextEl.style.display=""),this.regionSelectEl.style.display="none",Validation.reset(this.regionSelectEl)):this.disableAction=="disable"?(this.regionTextEl&&(this.regionTextEl.disabled=!1),this.regionSelectEl.disabled=!0):this.disableAction=="nullify"&&(this.regionSelectEl.options.length=1,this.regionSelectEl.value="",this.regionSelectEl.selectedIndex=0,this.lastCountryId=""),this.setMarkDisplay(this.regionSelectEl,!1);this._checkRegionRequired();r=new ZipUpdater(this.countryEl.value,this.zipEl);r.update()},setMarkDisplay:function(n,t){n=$(n);var i=n.up(0).down("label > span.required")||n.up(1).down("label > span.required")||n.up(0).down("label.required > em")||n.up(1).down("label.required > em");i&&(inputElement=i.up().next("input"),t?(i.show(),inputElement&&inputElement.addClassName("required-entry")):(i.hide(),inputElement&&inputElement.removeClassName("required-entry")))}};ZipUpdater=Class.create();ZipUpdater.prototype={initialize:function(n,t){this.country=n;this.zipElement=$(t)},update:function(){if(typeof optionalZipCountries=="undefined")return!1;this.zipElement!=undefined?(Validation.reset(this.zipElement),this._setPostcodeOptional()):Event.observe(window,"load",this._setPostcodeOptional.bind(this))},_setPostcodeOptional:function(){var t,n;if(this.zipElement=$(this.zipElement),this.zipElement==undefined)return!1;if(t=$$('label[for="'+this.zipElement.id+'"]')[0],t!=undefined&&(n=t.down("em")||t.down("span.required")),optionalZipCountries.indexOf(this.country)!=-1){while(this.zipElement.hasClassName("required-entry"))this.zipElement.removeClassName("required-entry");n!=undefined&&n.hide()}else this.zipElement.addClassName("required-entry"),n!=undefined&&n.show()}}